@{
    ViewBag.Title = "Add Manual Log";
    ViewBag.HasLeftPanel = true;
    Layout = "~/Views/Shared/_DriverLayout.cshtml";  
}
@section Header {
    <link rel="stylesheet" href="@Url.Content("~/Scripts/Openlayers/OpenLayers-2.12/theme/default/style.css")" type="text/css" />
    <link rel="stylesheet" href="@Url.Content("~/Content/style.mobile-jq.css?v=20130416")" type="text/css" />
    <script src="http://maps.googleapis.com/maps/api/js?v=3&client=gme-bsmwirelessinc&sensor=true&libraries=places"></script>
    <!--<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places" type="text/javascript"></script>-->
    <!--<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>-->
    <script type="text/javascript" src="@Url.Content("~/Scripts/Openlayers/OpenLayers-2.12/OpenLayers.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/mobile-base.js?v=" + ViewBag.LastUpdatedmobilebaseFile)"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/mobile-jq.js?v=" + ViewBag.LastUpdatedmobilejqFile)"></script>
    <script type="text/javascript" src="@ViewBag.SelectedLanguageUrl"></script>
    <style type="text/css">
        .ui-panel-inner {
            padding: 0;
        }

        .ui-listview-filter {
            margin: 0 !important;
        }

        #navigation .ui-btn-icon-notext {
            display: block;
            padding: 7px 6px 7px 8px;
        }

        .ui-controlgroup#navigation .ui-btn-icon-notext {
            height: 24px;
            width: 24px;
        }

            .ui-controlgroup#navigation .ui-btn-icon-notext .ui-btn-inner {
                height: 20px;
                padding: 2px 1px 2px 3px;
            }

        .searchcontain div.ui-input-text {
            width: 70% !important;
            margin-left: 10px !important;
            display: inline-block;
        }

        #searchCriteria div.ui-input-text {
            width: 50px !important;
            display: inline-block;
            vertical-align: middle;
        }

        #searchCriteria-popup .ui-select {
            width: auto !important;
            display: inline !important;
        }

        #searchCriteriaHeader .ui-title, #popupHeader .ui-title {
            margin-right: 10px;
            margin-left: 10px;
        }

        .historyCriteriaTitle, .historyCriteriaDate, .historyCriteriaTime {
            margin-left: 5px;
        }

        .historyCriteriaDate, .historyCriteriaTime {
            display: inline-block;
        }

        .historyCriteriaTitle {
            display: block;
        }

        .historyCriteriaDate div.ui-input-text {
            width: 140px !important;
            display: inline-block;
            vertical-align: middle;
        }

        .historyCriteriaTime div.ui-input-text {
            width: 100px !important;
            display: inline-block;
            vertical-align: middle;
        }

        #configContent div.ui-input-text {
            width: 170px !important;
            display: inline-block;
            vertical-align: middle;
        }

        .pac-item {
            font-size: 16px !important;
            padding: 2px 4px !important;
        }

        .ui-title {
            margin: 0.6em 0.6em 0.8em !important;
        }

        .textboxError {
            border: 1px solid red !important;
        }

        .ui-input-text {
            margin-left: 10px !important;
            margin-right: 10px !important;
        }

        .ui-select {
            margin-left: 10px !important;
            margin-right: 10px !important;
        }

    </style>

    <script type="text/javascript">
        var IsAuthorizedPath = "@Url.Content("~/Home/IsAuthorized/")";
        window.onload = function () {
            $.ajax({
                url: IsAuthorizedPath,
                success: function (result) {
                    if (result.IsAuthorized == 0) {
                        location.replace('@Url.Content("~/Account/Login/")');
                        return;
                    }
                },
                error: function (msg) {
                }
            });
        }

        window.onunload = function () {
        };


       </script>
}

@section LeftPanel {
    <div data-role="panel" id="left-panel" data-theme="b" style="background: #555555">
        @Html.Partial("../Home/_leftMenu", new SentinelMobile.Models.LeftMenu("AddDriverLog"))
    </div>
    <!-- /panel -->
}

@section Popup {
    <!--<div id="popup" data-role="popup" data-overlay-theme="a" data-theme="c" style="max-width:400px;" class="ui-corner-all">
        <div data-position="inline" data-theme="d" data-role="header" id="popupHeader">
            <h1>Vehicle Info</h1>
        </div>
        <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
            <ul id="details-list" data-role="listview">
            </ul>
            <div id="vehicleinfo" data-role="vehicleinfo" style="margin:20px;">
            </div>
            <a href="javascript:void(0)" onclick="$('#popup').popup('close');" data-role="button" data-theme="d" style="margin:40px 90px 20px 90px;">@SentinelMobile.Resources.Resources.OK</a>
        </div>        
    </div>-->
}

@section HeaderLeftButtons {
    <a href="#left-panel" data-role="button" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-inline="true">@SentinelMobile.Resources.Resources.Menu</a>
    <!--<a href="~/" data-role="button" data-icon="home" data-iconpos="notext" data-direction="reverse" data-inline="true">Home</a>-->
}

            <div data-role="footer"   data-position="fixed" data-fullscreen="true" data-tap-toggle="false" data-hide-during-focus="" style="z-index:2000;">
		        <!-- <div data-role="navbar" data-grid="a" id="divFootNavbar">
			        <ul id ="ulDriverView" >
                        <li><a href="#" onclick="javascript:AddmanualLog(); return false;" id="addmanualLog" data-icon="bars" data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.AddmanualLog</a></li>				    
                        <li id="liaddmanualback" ><a href="#" onclick="BackHistory();" id="aliaddmanualback" data-icon="star" data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.Back</a></li>
			        </ul>
                </div> -->
                <div data-role="navbar" data-grid="b" id="divFootNavbar_ext" >
			        <ul id ="ulAddDriverManualLogs" style="display:none"  >
                        <li id="liAddDuty"><a href="#" onclick="javascript:AddDuty(); return false;" data-inline="true"  data-icon="bars" data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.AddDuty</a></li>				    
                        <!-- <li id="liAddTripIndo"><a href="#" onclick="javascript:AddTripInfo(); return false;" data-inline="true"  data-icon="bars" data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.AddTripInfo</a></li>				    
                        <li id="liSubmit"><a href="#" onclick="javascript:Submit(0); return false;"  data-inline="true"  data-icon="bars" data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.Submit</a></li>-->
                        @{
                          SentinelMobile.Models.User user = Session != null ? (SentinelMobile.Models.User)Session["SentinelUser"] : null;
                          if (!user.IsDriver)
                          {
                         <li id="liApprove"><a href="#" onclick="javascript:ApprovePrompt(); return false;"  data-inline="true"  data-icon="bars" data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.Approve</a></li>				    
                          }
                          }
                        <li id="liBack"><a href="#" onclick="javascript:Back(1); return false;" data-icon="arrow-l" data-inline="true"  data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.Back</a></li>				    
			        </ul>
                    <ul id ="ulAddDriverManualDuty" style="display:none"  >
                        <li id="liSave"><a id="aliSave" href="#" onclick="javascript:Save(); return false;"  data-inline="true"  data-icon="bars" data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.Save</a></li>
                        <li id="liBackDuty"><a href="#" data-ajax="false" onclick="javascript:Back(0); return false;" data-icon="bars" data-inline="true"  data-role="button" data-rel="dialog" data-transition="none">@SentinelMobile.Resources.HOSResources.Summary</a></li>				    
                    </ul>
		        </div>
	        </div>

<div data-role="content" id="divAddMenualList" style ="display:none">
             <script type="text/javascript" >

                 $(document).ready(function () {
                     AddDriverLogReady(1);
                         });


                 function EnableControls(isEnable)
                 {
                     $("#ddlCycle").attr("disabled", isEnable);
                     $("#ddlAction").attr("disabled", isEnable);
                     $("#ddlDuty").attr("disabled", isEnable);
                     $("#ddlProvince").attr("disabled", isEnable);
                     $("#ddlCity").attr("disabled", isEnable);
                 }

                 function LoadDutyByRef() {

                     $('#txtDate').bind('datebox', function (e, p) {
                         if (p.method === 'open') {
                             e.stopImmediatePropagation()
                             EnableControls(true);
                         }
                         if (p.method === 'close') {
                             e.stopImmediatePropagation()
                             EnableControls(false);
                             //$('#ddlCycle').focus();
                             $('#liSave').focus();
                             //$('#ulAddDriverManualDuty').show();
                         }

                     });
                     $('#txtTime').bind('datebox', function (e, p) {
                         if (p.method === 'open') {
                             e.stopImmediatePropagation()
                             EnableControls(true);
                         }
                         if (p.method === 'close') {
                             e.stopImmediatePropagation()
                             EnableControls(false);
                             //$('#ddlCycle').focus();
                             $('#liSave').focus();
                             //$('#ulAddDriverManualDuty').show();
                         }

                     });

                     $('#txtDate').bind('datebox', function (e, p) {
                         if (p.method === 'open') {
                             e.stopImmediatePropagation()
                             EnableControls(true);
                         }
                     });
                     $('#txtTime').bind('datebox', function (e, p) {
                         if (p.method === 'open') {
                             e.stopImmediatePropagation()
                             EnableControls(true);
                         }
                     });

                     @if (ViewBag.tripInfo != null)
                    {
                
                        <text>
                     $("#txtDate").val('@ViewBag.tripInfo.date');
                     var myselect = $("#ddlCycle");
                     $(myselect).val('@ViewBag.tripInfo.cycle');
                     myselect.selectmenu("refresh");

                     $("#txtCompany").val('@ViewBag.tripInfo.company');
                     $("#txtShiftStart").val('@ViewBag.tripInfo.shiftStart');
                     $("#txtStartOdo").val('@ViewBag.tripInfo.odoStart');
                     $("#txtEndOdo").val('@ViewBag.tripInfo.odoEnd');
                     $("#txtCoDriver").val('@ViewBag.tripInfo.coDriver');
                     $("#txtHomeTerm").val('@ViewBag.tripInfo.hometerm');
                     $("#txtEquipmentNo").val('@ViewBag.tripInfo.equipmentNo');
                     $("#txtShippingDoc").val('@ViewBag.tripInfo.shippingDoc');
                     $("#txtTruckNo").val('@ViewBag.tripInfo.truckNo');
                     $("#txtTrailNo").val('@ViewBag.tripInfo.tailerNo');
                     $("#txtDefered").val('@ViewBag.tripInfo.deferredHours');
                     $("#txtEmergency").val('@ViewBag.tripInfo.emergency');
                     $("#txtPersonalStartOdo").val('@ViewBag.tripInfo.personalStart');
                     $("#txtPersonalEndOdo").val('@ViewBag.tripInfo.personalEnd');
                     $("#txtTripRemark").val('@ViewBag.tripInfo.remark  ');
                     isApprove = '@ViewBag.tripInfo.approved';
                     </text>
                    }

                     if (isDriver == 'true') $("#liApprove").remove();

                     @if (ViewBag.duties != null)
            {
                <text>
                     if (duties.length > 0)
                         duties.splice(0, duties.length);
                     </text>
                foreach (SentinelMobile.Models.Duty duty in ViewBag.duties)
                {
                 <text>
                     duties.push(new Duty('@duty.time', '@duty.duty', '@duty.action', '@duty.province',
                                 '@duty.city', '@duty.remark',
                        '@duty.dutyTxt', '@duty.actionTxt', '@duty.provinceTxt',
                        '@duty.cityTxt', '@duty.odometer', '@duty.TLID', '@duty.date', '@duty.cycle'));

                     </text>
                }
                <text>
                     duties.sort(SortDuty);
                     FillDutyGrid();
                     </text>
            }
                     if (isApprove == 'true') $("#liApprove").hide();
                     else $("#liApprove").show();
                     $('#driverpage').die('pageshow');
                     $.mobile.hidePageLoadingMsg();
                 }


                 function Back(isCheck) {
                     if ($("#divAddDuty").css('display') != 'none' ||
                         $("#divAddTripInfo").css('display') != 'none') {

                         if ($("#divAddDuty").css('display') != 'none') {
                             if (duties.length == 0)
                                 FillDutyGrid();
                             else GetLogData_Reference_ManualDutyByDate();
                         }
                         $("#divAddDuty").hide();
                         $("#divAddTripInfo").hide();
                         $("#divAddMenualList").show();
                         $("#liSubmit").show();
                         if (isApprove == 'true') $("#liApprove").hide();
                         else $("#liApprove").show();
                         $("#liAddDuty").show();
                         $("#liAddTripIndo").show();
                         $("#ulAddDriverManualLogs").show();
                         $("#ulAddDriverManualDuty").hide();
                         editIndex = -1;
                         deleteIndex = -1;
                     }
                     else {
                         BackToDriverView();
                     }
                 }

                 function BackToDriverView() {
                     curDriverId = '@user.DriverId';
                     curDriverName = '@user.DriverName';
                     var url = "@Html.Raw(Url.Action("DriverView", "HOS", new {driverId = -1,driverName = -2 } ))";
                     url = url.replace('-1', $.trim(curDriverId));
                     url = url.replace('-2', $.trim(curDriverName));
                     window.location = url;
                 }

            </script>

    <div id="divAddMenualviewwrapper" style="margin-bottom: 60px">
        <label style="color:red;margin-top:2px;margin-left:2px; margin-bottom:2px">@SentinelMobile.Resources.HOSResources.MakeSureLastOffDuty</label>
        <ul data-role="listview" data-filter="false" data-scroll="true" data-filter-placeholder="@SentinelMobile.Resources.HOSResources.SearchDrivers..." id="ulAddMenualViewList" >
        </ul>
    </div>
</div>

<div data-role="content" id="divAddDuty" style="display: none;margin-bottom:60px;z-index:50">
    <label style="color:red;margin-top:2px; margin-bottom:2px">@SentinelMobile.Resources.HOSResources.TimeRounded
    </label>
    <select name="ddlCycle" id="ddlCycle">
        <option value="0">@SentinelMobile.Resources.HOSResources.SelectCycle</option>
        <option value="6">Canadian Cycle 1</option>
        <option value="7">Canadian Cycle 2</option>
        <option value="18">Canadian Oil Field Rule</option>
        <option value="10">US 60/7</option>
        <option value="11">US 70/8</option>
        <option value="20">US Oil Field Rule</option>
    </select>
    
    <input name="txtDate" id="txtDate" type="text" data-inline="true" data-role="datebox" placeholder="@SentinelMobile.Resources.HOSResources.InputDate"  data-options='{"mode":"calbox","useDialogForceFalse":true, "zindex":10000}' "  />
    <input name="txtTime" id="txtTime" data-inline="true" type="text" data-role="datebox" placeholder="@SentinelMobile.Resources.HOSResources.InputTime"  data-options='{"mode":"timebox","useDialogForceFalse":true, "zindex":10000, "overrideTimeOutput":"%k:%M"}' />
    <select name="ddlDuty" id="ddlDuty">
        <option value="0">@SentinelMobile.Resources.HOSResources.SelectDuty</option>
        <option value="101">@SentinelMobile.Resources.HOSResources.OffDuty</option>
        <option value="104">@SentinelMobile.Resources.HOSResources.OnDuty</option>
        <option value="102">@SentinelMobile.Resources.HOSResources.Sleep</option>
        <option value="103">@SentinelMobile.Resources.HOSResources.Driving</option>
    </select>
    <select name="ddlAction" id="ddlAction">
        <option value="0">@SentinelMobile.Resources.HOSResources.SelectAction</option>
    </select>

    <select name="ddlProvince" id="ddlProvince">
        <option value="0">@SentinelMobile.Resources.HOSResources.SelectProvince</option>
        @if (ViewBag.States != null && ViewBag.States.Count > 0)
        {
            for (var i = 0; i < @ViewBag.States.Count; i++)
            {
            <option value="@ViewBag.States[i].State">@ViewBag.States[i].FullName</option>
            }
        }

    </select>
    <select name="ddlCity" id="ddlCity">
        <option value="0">@SentinelMobile.Resources.HOSResources.SelectCity</option>
    </select>
    <input type="number" name="txtOdometer" id="txtOdometer" value="" placeholder="@SentinelMobile.Resources.Resources.Odometer" />
    <input type="text" name="txtRemark" id="txtRemark" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputRemark"  />
</div>

<div data-role="popup" id="popupDialog" data-overlay-theme="a" data-theme="c" style="max-width:400px;" class="ui-corner-all">
		<div data-role="header" data-theme="a" class="ui-corner-top">
 			<h1</h1>
		</div>
		<div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
				<h3 class="ui-title">@SentinelMobile.Resources.HOSResources.AddedDutySuccessfully</h3>
				<a href="#" data-role="button" data-inline="true" data-rel="back" data-theme="c">@SentinelMobile.Resources.HOSResources.Yes</a>    
				<a href="#" onclick="javascript:Back(0);" data-role="button" data-inline="true" data-rel="back" data-transition="flow" data-theme="b">@SentinelMobile.Resources.HOSResources.No</a>  
		</div>
</div>

<div data-role="popup" id="popupDialogDelete" data-overlay-theme="a" data-theme="c" style="max-width:400px;" class="ui-corner-all">
		<div data-role="header" data-theme="a" class="ui-corner-top">
 			<h1</h1>
		</div>
		<div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
				<h3 class="ui-title">@SentinelMobile.Resources.HOSResources.ConfirmDelete</h3>
				<a href="#" onclick="javascript:Delete();" data-role="button" data-inline="true" data-rel="back" data-theme="c">@SentinelMobile.Resources.HOSResources.Yes</a>    
				<a href="#" data-role="button" data-inline="true" data-rel="back" data-transition="flow" data-theme="b">@SentinelMobile.Resources.HOSResources.No</a>  
		</div>
</div>


<div data-role="popup" id="popupDialogApprove" data-overlay-theme="a" data-theme="c" style="max-width:400px;" class="ui-corner-all">
		<div data-role="header" data-theme="a" class="ui-corner-top">
 			<h1</h1>
		</div>
		<div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
                <h3 class="ui-title"  style="color:red" id ="popupDialogApprove_H3Warning">@SentinelMobile.Resources.HOSResources.LastRecordNotOffDufty </h3>
				<h3 class="ui-title" id ="popupDialogApprove_H3">@SentinelMobile.Resources.HOSResources.ApprovePopup @user.DriverName?
				</h3>
				<a href="#" onclick="Approve()" data-ajax="false" data-role="button" data-inline="true" data-rel="back" data-theme="c">@SentinelMobile.Resources.HOSResources.Yes</a>    
				<a href="#" data-role="button" data-inline="true" data-rel="back" data-transition="flow" data-theme="b">@SentinelMobile.Resources.HOSResources.No</a>  
		</div>
</div>

<div data-role="content" id="divAddTripInfo" style="display: none;margin-bottom:60px">
    <input type="text" name="txtCompany" id="txtCompany" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputCompany"  />
    <input name="txtShiftStart" id="txtShiftStart" data-inline="true" type="text" data-role="datebox" placeholder="@SentinelMobile.Resources.HOSResources.InputShiftStart"  data-options='{"mode":"timeflipbox","zindex":"2000", "overrideTimeOutput":"%k:%M"}' />
    <input type="number" name="txtStartOdo" id="txtStartOdo" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputStartOdometer" />
    <input type="number" name="txtEndOdo" id="txtEndOdo" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputEndOdometer" />
    <input type="text" name="txtCoDriver" id="txtCoDriver" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputCoDriver"  />
    <input type="text" name="txtHomeTerm" id="txtHomeTerm" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputHomeTerminal"  />
    <input type="text" name="txtEquipmentNo" id="txtEquipmentNo" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputEquipmentNo"  />
    <input type="text" name="txtShippingDoc" id="txtShippingDoc" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputShippingDocument"  />
    <input type="text" name="txtTruckNo" id="txtTruckNo" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputTruckNo"  />
    <input type="text" name="txtTrailNo" id="txtTrailNo" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputTrailerNo"  />
    <input type="number" name="txtDefered" id="txtDefered" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputDeferred" />
    <fieldset data-role="controlgroup" data-type="horizontal" >
       <legend style="margin-left:10px"><b>@SentinelMobile.Resources.HOSResources.DeferredHoursUnder:</b></legend>
        <input type="radio" name="radDeferredHoursDay1" id="radDeferredHoursDay1"
            @if (ViewBag.tripInfo != null && ViewBag.tripInfo.deferredDay == "1")
            {
                <text>
                checked ="checked"
                </text>
            }
             value="day1"  />
     	<label style="margin-left:10px" for="radDeferredHoursDay1">@SentinelMobile.Resources.HOSResources.Day1</label>

     	<input type="radio" name="radDeferredHoursDay1" id="radDeferredHoursDay2" 
            @if (ViewBag.tripInfo != null && ViewBag.tripInfo.deferredDay == "2")
            {
                <text>
                checked ="checked"
                </text>
            }
             value="day2"  />
     	<label for="radDeferredHoursDay2">@SentinelMobile.Resources.HOSResources.Day2</label>
    </fieldset>
    <input type="text" name="txtEmergency" id="txtEmergency" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputEmergency"  />
    <label style="margin-left:10px" for="chkAdverseDriving">@SentinelMobile.Resources.HOSResources.AdverseDrivingCondition:</label>
    <input  type="checkbox" name="chkAdverseDriving" id="chkAdverseDriving" data-theme="a"
                 @if (ViewBag.tripInfo != null && ViewBag.tripInfo.adverseDriving == "True")
                 {
                <text>
                checked ="checked"
                </text>
                 }

         >
    <input type="number" name="txtPersonalStartOdo" id="txtPersonalStartOdo" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputPersonalUseStartOdo" />
    <input type="number" name="txtPersonalEndOdo" id="txtPersonalEndOdo" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputPersonalUseEndOdo" />
    <input type="text" name="txtTripRemark" id="txtTripRemark" value="" placeholder="@SentinelMobile.Resources.HOSResources.InputRemark" />
</div>
<script type="text/javascript">

    @if (ViewBag.Cycle != null)
      {
          <text>
          $("#ddlCycle").val('@ViewBag.Cycle');
          </text>
     }
   
</script>